{"version":3,"sources":["../../src/configurators/dll.ts"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAEO,eAAe,YAAf,CAA4B,YAA5B,EAA6D;AAClE,MAAI,WAAW,GAAkB,IAAjC;AACA,QAAM,UAAU,GAAG,YAAY,CAAC,UAAhC;;AAEA,MAAI,YAAY,CAAC,IAAb,KAAsB,cAA1B,EAA0C;AACxC,UAAM,GAAG,GAAG,YAAY,CAAC,4BAAb,CAA0C,QAA1C,CAAqD,GAAjE;;AACA,QAAI,GAAG,IAAI,IAAX,EAAiB;AACf,YAAM,IAAI,KAAJ,CAAU,yCAAV,CAAN;AACD;;AAED,IAAA,YAAY,CAAC,MAAb,CAAoB,KAApB,GAA4B,KAAK,CAAC,OAAN,CAAc,GAAd,IAAqB;AAAC,MAAA,MAAM,EAAE;AAAT,KAArB,GAAqC,GAAjE;AAEA,IAAA,WAAW,GAAG,IAAI,CAAC,IAAL,CAAU,YAAY,CAAC,mBAAvB,EAA4C,YAAY,CAAC,IAAzD,EAA+D,eAA/D,CAAd;AACA,IAAA,YAAY,CAAC,OAAb,CAAqB,IAArB,CAA0B,KAAI,oBAAJ,EAAc;AACtC,MAAA,IAAI,EAAE,QADgC;AAEtC,MAAA,IAAI,EAAE,WAFgC;AAGtC,MAAA,OAAO,EAAE;AAH6B,KAAd,CAA1B;AAMA,UAAM,MAAM,GAAG,YAAY,CAAC,MAAb,CAAoB,MAAnC,CAfwC,CAgBxC;;AACA,WAAO,MAAM,CAAC,aAAd;AACA,IAAA,MAAM,CAAC,OAAP,GAAiB,QAAjB;AACD,GAnBD,MAoBK,IAAI,YAAY,CAAC,IAAb,KAAsB,UAA1B,EAAsC;AACzC,UAAM,MAAM,GAAG,IAAI,CAAC,IAAL,CAAU,YAAY,CAAC,mBAAvB,EAA4C,cAA5C,CAAf;AACA,UAAM,OAAO,GAAG,MAAM,wBAAW,MAAX,CAAtB;;AACA,QAAI,OAAO,IAAI,IAAX,IAAmB,CAAC,OAAO,CAAC,WAAR,EAAxB,EAA+C;AAC7C,MAAA,YAAY,CAAC,KAAb,CAAmB,kBAAnB;AACA,aAAO,IAAP;AACD;;AAED,IAAA,YAAY,CAAC,KAAb,CAAmB,kBAAkB,MAAM,EAA3C;AACA,IAAA,YAAY,CAAC,OAAb,CAAqB,IAArB,CAA0B,KAAI,6BAAJ,EAAuB;AAC/C,MAAA,OAAO,EAAE,UADsC;AAE/C,MAAA,QAAQ,EAAE,MAAM,yBAAS,IAAI,CAAC,IAAL,CAAU,MAAV,EAAkB,eAAlB,CAAT;AAF+B,KAAvB,CAA1B;AAID;;AAED,SAAO,WAAP;AACD;;AAEM,eAAe,YAAf,CAA4B,MAA5B,EAA4C,YAA5C,EAA6E;AAClF,MAAI,YAAY,CAAC,4BAAb,CAA0C,QAA1C,CAAqD,GAArD,IAA4D,IAAhE,EAAsE;AACpE,WAAO,EAAP;AACD;;AAED,QAAM,KAAK,GAAG,MAAM,kCAAqB,wBAAQ,MAAR,CAArB,CAApB;AACA,SAAO,KAAK,IAAI,IAAT,GAAgB,EAAhB,GAAqB,KAAK,CAAC,MAAN,CAAa,EAAE,IAAI,EAAE,CAAC,QAAH,CAAY,KAAZ,KAAsB,EAAE,CAAC,QAAH,CAAY,MAAZ,CAAzC,EAA8D,IAA9D,EAA5B;AACD,C","sourcesContent":["import { readdir, readJson } from \"fs-extra\"\nimport * as path from \"path\"\nimport { DllPlugin, DllReferencePlugin } from \"webpack\"\nimport { WebpackConfigurator } from \"../main\"\nimport { orNullIfFileNotExist, statOrNull } from \"../util\"\n\nexport async function configureDll(configurator: WebpackConfigurator): Promise<string | null> {\n  let dllManifest: string | null = null\n  const projectDir = configurator.projectDir\n\n  if (configurator.type === \"renderer-dll\") {\n    const dll = configurator.electronWebpackConfiguration.renderer!!.dll\n    if (dll == null) {\n      throw new Error(`renderer-dll requires DLL configuration`)\n    }\n\n    configurator.config.entry = Array.isArray(dll) ? {vendor: dll} : dll\n\n    dllManifest = path.join(configurator.commonDistDirectory, configurator.type, \"manifest.json\")\n    configurator.plugins.push(new DllPlugin({\n      name: \"[name]\",\n      path: dllManifest,\n      context: projectDir,\n    }))\n\n    const output = configurator.config.output!\n    // leave as default \"var\"\n    delete output.libraryTarget\n    output.library = \"[name]\"\n  }\n  else if (configurator.type === \"renderer\") {\n    const dllDir = path.join(configurator.commonDistDirectory, \"renderer-dll\")\n    const dirStat = await statOrNull(dllDir)\n    if (dirStat == null || !dirStat.isDirectory()) {\n      configurator.debug(\"No DLL directory\")\n      return null\n    }\n\n    configurator.debug(`DLL directory: ${dllDir}`)\n    configurator.plugins.push(new DllReferencePlugin({\n      context: projectDir,\n      manifest: await readJson(path.join(dllDir, \"manifest.json\")),\n    }))\n  }\n\n  return dllManifest\n}\n\nexport async function getDllAssets(dllDir: string, configurator: WebpackConfigurator) {\n  if (configurator.electronWebpackConfiguration.renderer!!.dll == null) {\n    return []\n  }\n\n  const files = await orNullIfFileNotExist(readdir(dllDir))\n  return files == null ? [] : files.filter(it => it.endsWith(\".js\") || it.endsWith(\".css\")).sort()\n}"],"sourceRoot":""}
