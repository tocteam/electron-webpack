{"version":3,"sources":["../../src/configurators/ts.ts"],"names":[],"mappings":";;;;;;;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAEO,eAAe,mBAAf,CAAmC,YAAnC,EAAoE;AACzE,QAAM,YAAY,GAAG,YAAY,CAAC,gBAAb,CAA8B,gCAA9B,KAAmE,YAAY,CAAC,gBAAb,CAA8B,qBAA9B,CAAxF;;AACA,MAAI,EAAE,YAAY,IAAI,YAAY,CAAC,gBAAb,CAA8B,WAA9B,CAAlB,CAAJ,EAAmE;AACjE;AACD,GAJwE,CAMzE;;;AACA,EAAA,YAAY,CAAC,UAAb,CAAwB,MAAxB,CAA+B,CAA/B,EAAkC,CAAlC,EAAqC,KAArC,EAA4C,MAA5C;AAEA,QAAM,eAAe,GAAG,YAAY,CAAC,MAAb,IAAwB,YAAY,IAAI,CAAC,YAAY,CAAC,YAA9E;AAEA,QAAM,YAAY,GAAG,MAAM,kCAAqB,CAAC,IAAI,CAAC,IAAL,CAAU,YAAY,CAAC,SAAvB,EAAkC,eAAlC,CAAD,EAAqD,IAAI,CAAC,IAAL,CAAU,YAAY,CAAC,UAAvB,EAAmC,eAAnC,CAArD,CAArB,EAAgI,IAAhI,CAA3B,CAXyE,CAYzE;;AACA,MAAI,YAAY,IAAI,IAApB,EAA0B;AACxB,UAAM,IAAI,KAAJ,CAAU,uCAAuC,YAAY,CAAC,UAAU,mFAAxE,CAAN;AACD;;AAED,MAAI,YAAY,CAAC,KAAb,CAAmB,OAAvB,EAAgC;AAC9B,IAAA,YAAY,CAAC,KAAb,CAAmB,SAAS,YAAY,EAAxC;AACD,GAnBwE,CAqBzE;;;AACA,MAAI,eAAe,IAAI,CAAC,YAAY,CAAC,MAArC,EAA6C;AAC3C,UAAM,MAAM,GAAG,YAAY,CAAC,aAAb,CAA2B,KAA3B,CAAf;;AACA,UAAM,0BAA0B,GAAG,OAAO,CAAC,gCAAD,CAA1C;;AACA,IAAA,YAAY,CAAC,OAAb,CAAqB,IAArB,CAA0B,IAAI,0BAAJ,CAA+B;AACvD,MAAA,QAAQ,EAAE,YAD6C;AAEvD,MAAA,MAAM,EAAE,YAAY,CAAC,GAAb,CAAiB,mBAAjB,IAAwC;AAC9C,QAAA,IAAI,EAAE,MAAK,CACT;AACD,SAH6C;AAK9C,QAAA,IAAI,EAAE,OAAO,CAAC,IAAR,CAAa,IAAb,CAAkB,OAAlB,CALwC;AAM9C,QAAA,KAAK,EAAE,OAAO,CAAC,KAAR,CAAc,IAAd,CAAmB,OAAnB;AANuC,OAFO;AAUvD,MAAA,GAAG,EAAE;AAVkD,KAA/B,CAA1B;AAYD;;AAED,QAAM,eAAe,GAAQ;AAC3B;AACA;AACA,IAAA,aAAa,EAAE,eAHY;AAI3B,IAAA,gBAAgB,EAAE,CAAC,QAAD,CAJS;AAK3B,IAAA,UAAU,EAAE;AALe,GAA7B;;AAQA,MAAI,YAAY,CAAC,KAAb,CAAmB,OAAvB,EAAgC;AAC9B,IAAA,YAAY,CAAC,KAAb,CAAmB,sBAAsB,IAAI,CAAC,SAAL,CAAe,eAAf,EAAgC,IAAhC,EAAsC,CAAtC,CAAwC,EAAjF;AACD;;AAED,EAAA,YAAY,CAAC,KAAb,CAAmB,IAAnB,CAAwB;AACtB,IAAA,IAAI,EAAE,SADgB;AAEtB,IAAA,OAAO,EAAE,cAFa;AAGtB,IAAA,GAAG,EAAE,CACH;AACE,MAAA,MAAM,EAAE,WADV;AAEE,MAAA,OAAO,EAAE;AAFX,KADG;AAHiB,GAAxB;AAUD,C","sourcesContent":["import * as path from \"path\"\nimport { WebpackConfigurator } from \"../main\"\nimport { getFirstExistingFile } from \"../util\"\n\nexport async function configureTypescript(configurator: WebpackConfigurator) {\n  const hasTsChecker = configurator.hasDevDependency(\"fork-ts-checker-webpack-plugin\") || configurator.hasDevDependency(\"electron-webpack-ts\")\n  if (!(hasTsChecker || configurator.hasDevDependency(\"ts-loader\"))) {\n    return\n  }\n\n  // add after js\n  configurator.extensions.splice(1, 0, \".ts\", \".tsx\")\n\n  const isTranspileOnly = configurator.isTest || (hasTsChecker && !configurator.isProduction)\n\n  const tsConfigFile = await getFirstExistingFile([path.join(configurator.sourceDir, \"tsconfig.json\"), path.join(configurator.projectDir, \"tsconfig.json\")], null)\n  // check to produce clear error message if no tsconfig.json\n  if (tsConfigFile == null) {\n    throw new Error(`Please create tsconfig.json in the \"${configurator.projectDir}\":\\n\\n{\\n  \"extends\": \"./node_modules/electron-webpack/tsconfig-base.json\"\\n}\\n\\n`)\n  }\n\n  if (configurator.debug.enabled) {\n    configurator.debug(`Using ${tsConfigFile}`)\n  }\n\n  // no sense to use fork-ts-checker-webpack-plugin for production build\n  if (isTranspileOnly && !configurator.isTest) {\n    const hasVue = configurator.hasDependency(\"vue\")\n    const ForkTsCheckerWebpackPlugin = require(\"fork-ts-checker-webpack-plugin\")\n    configurator.plugins.push(new ForkTsCheckerWebpackPlugin({\n      tsconfig: tsConfigFile,\n      logger: configurator.env.forkTsCheckerLogger || {\n        info: () => {\n          // ignore\n        },\n\n        warn: console.warn.bind(console),\n        error: console.error.bind(console),\n      },\n      vue: hasVue\n    }))\n  }\n\n  const tsLoaderOptions: any = {\n    // use transpileOnly mode to speed-up compilation\n    // in the test mode also, because checked during dev or production build\n    transpileOnly: isTranspileOnly,\n    appendTsSuffixTo: [/\\.vue$/],\n    configFile: tsConfigFile,\n  }\n\n  if (configurator.debug.enabled) {\n    configurator.debug(`ts-loader options: ${JSON.stringify(tsLoaderOptions, null, 2)}`)\n  }\n\n  configurator.rules.push({\n    test: /\\.tsx?$/,\n    exclude: /node_modules/,\n    use: [\n      {\n        loader: \"ts-loader\",\n        options: tsLoaderOptions\n      },\n    ],\n  })\n}"],"sourceRoot":""}
